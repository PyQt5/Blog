{"author":"Irony","title":"PyQt5之图片轮播","slug":"pageswitching","date":"2018-11-24 21:45:06","updated":"2019-11-22T10:02:42.180Z","comments":true,"path":"api/articles/pageswitching.json","url":"https://pyqt5.com/pageswitching.html","excerpt":"之前看到了QStackedWidget做切换动画，让界面不那么生硬，于是参考了 http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt 做了一个QStackedWidget的切换动画，然后利用QStackedWidget结合多个QLabel显示图片来做一个轮播效果。其实在写之前也在网上找了很多例子，参看过后发现大多例子都是利用到了paintEvent去绘制，这样其实还是比较麻烦，个人觉得更好的方式是使用QPropertyAnimation属性动画修改控件中QLabel图片控件的pos位置属性就可以达到移动效果了。<br>","covers":["https://github.com/PyQt5/PyQt/raw/master/QPropertyAnimation/ScreenShot/PageSwitching.gif"],"content":"<p>之前看到了<code>QStackedWidget</code>做切换动画，让界面不那么生硬，于是参考了 <a href=\"http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt\" target=\"_blank\" rel=\"noopener\">http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt</a> 做了一个<code>QStackedWidget</code>的切换动画，然后利用<code>QStackedWidget</code>结合多个<code>QLabel</code>显示图片来做一个轮播效果。</p>\n<p>其实在写之前也在网上找了很多例子，参看过后发现大多例子都是利用到了<code>paintEvent</code>去绘制，这样其实还是比较麻烦，个人觉得更好的方式是使用<code>QPropertyAnimation</code>属性动画修改控件中<code>QLabel</code>图片控件的pos位置属性就可以达到移动效果了。<br><a id=\"more\"></a></p>\n<ol>\n<li>比较核心的算法就是要计算当前页面和下一个页面的位置偏移量，比如:</li>\n</ol>\n<pre><code class=\"python\"># 计算偏移量\noffsetX = self.frameRect().width()\noffsetY = self.frameRect().height()\nw_next.setGeometry(0, 0, offsetX, offsetY)\n\nif direction == self.BOTTOM2TOP:\n    offsetX = 0\n    offsetY = -offsetY\nelif direction == self.TOP2BOTTOM:\n    offsetX = 0\nelif direction == self.RIGHT2LEFT:\n    offsetX = -offsetX\n    offsetY = 0\nelif direction == self.LEFT2RIGHT:\n    offsetY = 0\n\n# 重新定位显示区域外部/旁边的下一个窗口小部件\npnext = w_next.pos()\npnow = w_now.pos()\nself._pnow = pnow\n\n# 移动到指定位置并显示\nw_next.move(pnext.x() - offsetX, pnext.y() - offsetY)\nw_next.show()\nw_next.raise_()\n</code></pre>\n<ol start=\"2\">\n<li><p>其次是对这两个页面增加关联<code>pos</code>属性的<code>QPropertyAnimation</code>动画，然后加入到并行动画组<code>QParallelAnimationGroup</code>中再启动即可。</p>\n</li>\n<li><p>对<code>QStackedWidget</code>的<code>setCurrentIndex</code>和<code>setCurrentWidget</code>这两个函数进行了覆盖重写达到及时手动调用这两个函数也会产生动画效果的目的。</p>\n</li>\n</ol>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p><a href=\"https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/PageSwitching.py\" target=\"_blank\" rel=\"noopener\">https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/PageSwitching.py</a></p>\n<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><img src=\"https://github.com/PyQt5/PyQt/raw/master/QPropertyAnimation/ScreenShot/PageSwitching.gif\" alt=\"PageSwitching\"></p>\n","raw":"---\nauthor: Irony\ntitle: PyQt5之图片轮播\ndate: 2018-11-24 21:45:06\ntop: 1\ntags: \n - PyQt\n - 轮播\n - 动画\ncategories: 例子\n---\n\n之前看到了`QStackedWidget`做切换动画，让界面不那么生硬，于是参考了 http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt 做了一个`QStackedWidget`的切换动画，然后利用`QStackedWidget`结合多个`QLabel`显示图片来做一个轮播效果。\n\n其实在写之前也在网上找了很多例子，参看过后发现大多例子都是利用到了`paintEvent`去绘制，这样其实还是比较麻烦，个人觉得更好的方式是使用`QPropertyAnimation`属性动画修改控件中`QLabel`图片控件的pos位置属性就可以达到移动效果了。\n<!-- more -->\n\n1. 比较核心的算法就是要计算当前页面和下一个页面的位置偏移量，比如:\n\n```python\n# 计算偏移量\noffsetX = self.frameRect().width()\noffsetY = self.frameRect().height()\nw_next.setGeometry(0, 0, offsetX, offsetY)\n\nif direction == self.BOTTOM2TOP:\n    offsetX = 0\n    offsetY = -offsetY\nelif direction == self.TOP2BOTTOM:\n    offsetX = 0\nelif direction == self.RIGHT2LEFT:\n    offsetX = -offsetX\n    offsetY = 0\nelif direction == self.LEFT2RIGHT:\n    offsetY = 0\n\n# 重新定位显示区域外部/旁边的下一个窗口小部件\npnext = w_next.pos()\npnow = w_now.pos()\nself._pnow = pnow\n\n# 移动到指定位置并显示\nw_next.move(pnext.x() - offsetX, pnext.y() - offsetY)\nw_next.show()\nw_next.raise_()\n```\n\n2. 其次是对这两个页面增加关联`pos`属性的`QPropertyAnimation`动画，然后加入到并行动画组`QParallelAnimationGroup`中再启动即可。\n\n3. 对`QStackedWidget`的`setCurrentIndex`和`setCurrentWidget`这两个函数进行了覆盖重写达到及时手动调用这两个函数也会产生动画效果的目的。\n\n## 代码\n\nhttps://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/PageSwitching.py\n\n## 效果图\n\n![PageSwitching](https://github.com/PyQt5/PyQt/raw/master/QPropertyAnimation/ScreenShot/PageSwitching.gif)","categories":[{"name":"例子","path":"api/categories/例子.json"}],"tags":[{"name":"PyQt","path":"api/tags/PyQt.json"},{"name":"动画","path":"api/tags/动画.json"},{"name":"轮播","path":"api/tags/轮播.json"}]}